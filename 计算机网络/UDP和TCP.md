# UDP 和 TCP

UDP：用户数据报协议（User Datagram Protocol）
TCP：传输控制协议（Transmission Control Protocol）

UDP 和 TCP 是**TCP/IP体系结构**运输层中的两个重要协议。在使用TCP/IP体系结构的网络通信中，这两个协议的使用频率仅次于网际层的 IP 协议。TCP/IP体系结构应用层的某些协议，需要使用运输层TCP提供的服务，而另一些协议需要使用运输层的UDP提供的服务。

<img src="./image/TCP%20IP体系结构.png" width="100%">


## UDP 和 TCP 的对比

1、关于面向连接

这是因特网的两台主机，他们在运输层使用UDP 协议进行通信。纵坐标为时间，使用UDP 协议的通信双方，可以随时发送数据。
使用TCP 协议的通信双方，在进行数据传输之前，必须使用“三报文握手”来建立TCP 连接，TCP连接建立成功后才能进行数据传输。数据传输结束后，必须使用“四报文挥手”来释放TCP连接。
需要注意的是，这里所谓的连接是指逻辑连接关系，而不是物理连接。

总结：UDP 无连接，TCP 面向连接。

![TCP/IP体系结构](./image/TCP%20UDP对比.png)

2、关于通信

这是某个局域网上需要使用UDP协议进行通信的四台主机，其中任何一台主机都可以向其他三台主机发送广播，也可以向某个多播组发送多播，还可以向某台主机发送单播。

<img src="./image/UDP广播.png" width="30%">
<img src="./image/UDP多播.png" width="30%">
<img src="./image/UDP单播.png" width="30%">

总结：UDP 支持单播、多播以及广播。换句话说，UDP支持一对一、一对多、一对全的通信。

![TCP/IP体系结构](./image/UDP播.png)

使用TCP 协议通信的双方在进行数据传输之前，必须使用“三报文握手”来建立TCP 连接。TCP 连接建立成功之后，通信双方之间好像有一条可靠的通信信道。通信双方使用这条基于TCP连接的可靠信道进行通信。

![TCP/IP体系结构](./image/TCP三次握手.png)

![TCP/IP体系结构](./image/TCP发送.png)

![TCP/IP体系结构](./image/TCP接收.png)


总结：TCP 仅支持单播，也就是一对一的通信。

3、关于应用报文

发送方的应用进程将应用层报文交付给运输层的UDP，UDP直接给应用层报文添加一个UDP首部，使之成为UDP用户数据报，然后进行发送。接收方的UDP收到该UDP用户数据报后，去掉UDP首部，将应用层报文直接交付给应用进程。

![TCP/IP体系结构](./image/UDP应用报文.png)

总结：UDP 对应用进程交下来的报文既不合并也不拆分，而是保留这些报文的边界，换句话说，UDP是**面向应用报文**（面向报文段）的。

发送方的TCP 把应用进程交付下来的数据块仅仅看作是一连串的、无结构的字节流。TCP并不知道这些待传送的字节流的含义，仅将他们编号并存储在自己的发送缓存中，TCP 根据发送策略从发送缓存中提取一定数量的字节构建TCP 报文段并发送。接收方的TCP 一方面从所接收到的TCP报文段中取出数据载荷部分并存储在接收缓存中，一方面将接收缓存中的一些字节交付给应用进程。TCP不保证接收方应用进程所收到的数据块与发送方进程所发出的数据块具有对应大小的关系。例如发送方应用进程交给发送方的TCP共10个数据块，但接受方的TCP可能只用了4个数据块就把收到的字节流交付给了上层的应用进程。但接收方应用进程收到的字节流必须和发送方应用进程发出的字节流完全一样。
